{% extends "layouts/base.html" %}

{% block content %}

<div class="max-w-full w-full flex items-center justify-around mb-6">
    <h1 class="p-6 text-5xl font-bold text-center text-blue-2">專家列表</h1>
</div>

<section class="max-w-full w-full flex flex-col lg:flex-row items-center justify-center mb-6">
    <div class="flex justify-center items-center w-full max-w-full sm:w-1/5 m-2" x-data="{ selectedLabel: localStorage.getItem('selectedLabel') || '' }">
        <form method="get" class="flex" action="/teachers/">
            <input id="search-input" type="text" name="search" placeholder="搜尋暱稱或專家名" class="input border border-blue-1">
            <button type="submit" class="ml-2 btn bg-vanilla-5 border border-blue-1" @click="trimInput()">搜尋
            </button>
        </form>
    </div>
    <div class="m-2 flex justify-center max-w-full" x-data="{ selectedLabel: localStorage.getItem('selectedLabel') || '' }">
        <div class="relative m-2">
            <select class="input border border-blue-1 text-xl" @change="selectedLabel = $event.target.value; localStorage.setItem('selectedLabel', $event.target.value); window.location.href = '?label=' + encodeURIComponent($event.target.value)">
                <option value="" :selected="selectedLabel === ''" selected="selected">選擇專業標籤</option>
                {% for label in all_labels %}
                    <option value="{{ label|lower }}" :selected="selectedLabel === '{{ label|lower }}'">{{ label }}</option>
                {% endfor %}
            </select>
        </div>
        <a href="{% url 'teachers:index' %}" class="btn btn-outline border border-blue-1 m-2 max-w-full text-xl sm:w-auto" @click="selectedLabel = ''; localStorage.removeItem('selectedLabel')">重置標籤</a>
    </div>
</section>

<div class="flex flex-wrap w-full max-w-full h-full mx-auto">
    <div class="flex-1 max-w-4xl mx-auto m-3">
        <div class="max-w-4xl m-auto p-2">
            <section>
                {% if no_results %}
                    <div class="text-xl mt-4 text-center">
                        未找到任何結果，目前僅支持暱稱或使用者名稱的搜尋。
                    </div>
                {% else %}
                    {% for teacher in teachers %}
                    <a href="{% url 'teachers:show' teacher.id %}"
                        class="w-full max-w-full block mb-4 p-4 shadow-md rounded-lg duration-300 hover:bg-gray-300">
                        <div class="flex flex-col lg:flex-row justify-around w-full max-w-full">
                            <div class="flex justify-center items-center max-w-full w-full lg:w-1/3">
                                {% if teacher.user.profile_picture %}
                                    <img src="{{ teacher.user.profile_picture.url }}" alt="Profile Picture" class="w-1/2 h-32 object-center rounded-full">
                                {% else %}
                                    <img src="https://fakeimg.pl/240x240/282828/eae0d0/?text=User+Avatar" alt="User Avatar" class="w-1/2 h-32 object-center rounded-full">
                                {% endif %}
                            </div>
                            <div class="flex flex-col justify-around mt-4 lg:mt-0 w-full lg:w-2/3 max-w-full text-center lg:text-left">
                                <h3 class="text-2xl text-center font-semibold leading-normal text-blue-2">{{ teacher.user.get_display_name }}</h3>
                                <p class="m-2 text-xl text-center leading-normal">
                                專業能力:
                                {% if teacher.labels.all.exists %}
                                    {% for label in teacher.labels.all %}
                                    <span>{{ label.name }}</span>
                                    {% endfor %}
                                {% endif %}
                                </p>
                            </div>
                        </div>
                        <div class="mt-4 lg:mt-0" x-data="{ isMobile: window.innerWidth < 640 }" x-init="$watch('isMobile', value => isMobile = window.innerWidth < 640)">
                            <p class="text-gray-600 mt-1 text-xl leading-relaxed break-all break-words">
                                <span x-show="!isMobile">{{ teacher.introduce|truncatechars:100 }}</span>
                                <span x-show="isMobile">{{ teacher.introduce|truncatechars:20 }}...</span>
                            </p>
                        </div>
                    </a>
                    {% endfor %}
                {% endif %}
            </section>
        </div>
        <div>
            {% include "shared/pagination.html" with pages=teachers only %}
        </div>
    </div>
</div>

{% endblock %}