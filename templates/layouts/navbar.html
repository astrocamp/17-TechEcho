<nav class="sticky top-0 left-0 z-20 w-full p-6 bg-blue-1"
  x-data="{ open: false, submenuOpen: false, expertOpen: false, userMenuOpen: false}"
  @resize.window="if (window.innerWidth > 768) open = false">
  <div class="flex items-center justify-between">
    <div class="text-4xl font-bold text-white animate-pulse whitespace-nowrap">
      <a href="{% url 'index' %}">TechEcho( )</a>
    </div>

    {% if request.path != '/' %}
    <form action="{% url 'search' %}" method="GET" class="relative flex-grow max-w-lg mx-4" id="search-form">
      <input type="text" id="tags" name="q" placeholder="Search..."
        class="w-full h-12 p-2 pr-6 bg-white border border-gray-300" value='{{ search_terms }}' />
      <button type="submit" class="absolute inset-y-0 right-0 flex items-center px-3 bg-transparent">
        <i class="fa-solid fa-magnifying-glass"></i>
      </button>
    </form>
    {% endif %}

    <button @click="open = !open" class="relative text-xl text-white md:hidden whitespace-nowrap">
      選單
    </button>

    <ul class="hidden space-x-4 text-xl text-white md:flex whitespace-nowrap">
      <li class="relative tooltip tooltip-bottom" data-tip="問看看？">
        <a href="#" @click="submenuOpen = !submenuOpen"
          class="transition duration-300 ease-in-out hover:text-green-3">討論</a>
        <ul x-show="submenuOpen" @click.away="submenuOpen = false"
          class="absolute left-0 z-20 mt-9 text-green-3 w-60 bg-vanilla-5" style="display: none">
          <li>
            <a href="{% url 'questions:new' %}"
              class="block px-4 py-2 transition duration-300 ease-in-out hover:bg-green-4">發問題</a>
          </li>
          <li>
            <a href="{% url 'questions:index' %}"
              class="block px-4 py-2 transition duration-300 ease-in-out hover:bg-green-4">看問題</a>
          </li>
        </ul>
      </li>
      <li class="relative tooltip tooltip-bottom" data-tip="找專家？">
        <a href="#" @click="expertOpen = !expertOpen"
          class="transition duration-300 ease-in-out hover:text-green-3">專家</a>
        <ul x-show="expertOpen" @click.away="expertOpen = false"
          class="absolute left-0 z-20 mt-9 text-green-3 w-60 bg-vanilla-5" style="display: none">
          <li>
            <a href="{% url 'teachers:mentor' %}"
              class="block px-4 py-2 transition duration-300 ease-in-out hover:bg-green-4">當專家</a>
          </li>
          <li>
            <a href="{% url 'payments:index' %}"
              class="block px-4 py-2 transition duration-300 ease-in-out hover:bg-green-4">問專家</a>

          </li>
        </ul>
      </li>
      <li>
        <a href="#" class="transition duration-300 ease-in-out hover:text-green-3">教學</a>
      </li>

      {% if user.is_authenticated %}
      <div class="relative inline-flex items-center">
        <span class="transition duration-300 ease-in-out pr-3">{{ user.username }}</span>
        <img
          src="https://fakeimg.pl/240x240/282828/eae0d0/?text=User+Avatar"
          alt="User Avatar" class="w-7 h-7 rounded-full cursor-pointer" @click="userMenuOpen = !userMenuOpen">

          <ul x-show="userMenuOpen" @click.away="userMenuOpen = false"
          class="absolute left-0 z-20 top-5 mt-9 text-green-3 w-60 bg-vanilla-5" style="display: none">
          <li>
            <a href="{% url 'users:profile' %}" class="block px-4 py-2 transition duration-300 ease-in-out hover:bg-green-4">個人簡介</a>
          </li>
          <li>
            <a href="{% url 'users:logout' %}"
              class="block px-4 py-2 transition duration-300 ease-in-out hover:bg-green-4">登出</a>
          </li>
        </ul>
      </div>
      {% include "shared/notification.html" with user=user only%}
      {% else %}
      <li>
        <a href="{% url 'users:login'%}?next={{ request.path }}"
          class="transition duration-300 ease-in-out hover:text-green-3">登入</a>
      </li>
      <li class="relative tooltip tooltip-bottom" data-tip="沒有帳號？">
        <a href="{% url 'users:register' %}" class="transition duration-300 ease-in-out hover:text-green-3">註冊</a>
      </li>
      {% endif %}
    </ul>

  </div>

  <ul class="absolute right-0 z-10 w-full mt-6 text-lg bg-vanilla-5" x-show="open" @click.away="open = false"
    style="display: none">

    <li @click="submenuOpen = !submenuOpen">
      <a href="#" class="block px-4 py-2 transition duration-300 ease-in-out text-green-3 hover:bg-green-4">討論</a>
      <ul x-show="submenuOpen" class="mt-2 ml-4">
        <li>
          <a href="{% url 'questions:new' %}"
            class="block px-4 py-2 transition duration-300 ease-in-out text-green-3 hover:bg-green-4">發問題</a>
        </li>
        <li>
          <a href="{% url 'questions:index' %}"
            class="block px-4 py-2 transition duration-300 ease-in-out text-green-3 hover:bg-green-4">看問題</a>
        </li>
      </ul>
    </li>
    <li @click="expertOpen = !expertOpen">
      <a href="#" class="block px-4 py-2 transition duration-300 ease-in-out text-green-3 hover:bg-green-4">專家</a>
      <ul x-show="expertOpen" class="mt-2 ml-4">
        <li>
          <a href="{% url 'teachers:new' %}"
            class="block px-4 py-2 transition duration-300 ease-in-out text-green-3 hover:bg-green-4">當專家</a>
        </li>
        <li>
          <a href="{% url 'teachers:index' %}"
            class="block px-4 py-2 transition duration-300 ease-in-out text-green-3 hover:bg-green-4">問專家</a>

        </li>
      </ul>
    </li>
    <li>
      <a href="#" class="block px-4 py-2 transition duration-300 ease-in-out text-green-3 hover:bg-green-4">教學</a>
    </li>
    {% if user.is_authenticated %}
    </li>

    <li>
      <a href="{% url 'users:logout'%}"
        class="block px-4 py-2 transition duration-300 ease-in-out text-green-3 hover:bg-green-4">登出</a>
    </li>
    {% else %}
    <li>
      <a href="{% url 'users:login'%}?next={{ request.path }}"
        class="block px-4 py-2 transition duration-300 ease-in-out text-green-3 hover:bg-green-4">登入</a>
    </li>
    <li class="relative tooltip tooltip-bottom" data-tip="沒有帳號？">
      <a href="{% url 'users:register' %}"
        class="block px-4 py-2 transition duration-300 ease-in-out text-green-3 hover:bg-green-4">註冊</a>
    </li>
    {% endif %}
  </ul>
</nav>